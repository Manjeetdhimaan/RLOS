IF OBJECT_ID ('dbo.NG_RLOS_PORTAL_SAVE_PREFERENCE') IS NOT NULL
	DROP PROCEDURE dbo.NG_RLOS_PORTAL_SAVE_PREFERENCE
GO

CREATE PROCEDURE NG_RLOS_PORTAL_SAVE_PREFERENCE
(
	@Workitem_Name NVARCHAR(100),
	@VISITOR_IP NVARCHAR(50),
	@LastVisitedPage NVARCHAR(100),
	@IS_COMPLETE NVARCHAR(5)	
)
AS
SET NOCOUNT ON
BEGIN
	DECLARE @Count INTEGER, @Operation NVARCHAR(100);

	SELECT @Count = count(*) FROM NG_RLOS_PORTAL_PREFRENCES WHERE Workitem_Name = @Workitem_Name
	IF(@Count>0)
	BEGIN
		IF(@IS_COMPLETE = '1')
		BEGIN 
			UPDATE NG_RLOS_PORTAL_PREFRENCES SET 
				LAST_VISITED_PAGE = @LastVisitedPage,
				VISITOR_IP = @VISITOR_IP,
				LAST_MODIFIED_ON = getdate(),
				COMPLETED_ON = getdate(),
				STATUS = 'COMPLETED'
			WHERE Workitem_Name = @Workitem_Name;
		END
		ELSE 	
		BEGIN  
			UPDATE NG_RLOS_PORTAL_PREFRENCES SET
				LAST_VISITED_PAGE = @LastVisitedPage,
				VISITOR_IP = @VISITOR_IP,
				LAST_MODIFIED_ON = getdate()
	  		WHERE Workitem_Name = @Workitem_Name;
		END
	END
	ELSE
	BEGIN
		INSERT INTO NG_RLOS_PORTAL_PREFRENCES(Workitem_Name, LAST_VISITED_PAGE, VISITOR_IP, STATUS)
		VALUES(@Workitem_Name, @LastVisitedPage, @VISITOR_IP, 'IN_PROGRESS');
	END
	SELECT 1 AS 'code'
END

GO